# 临工用工模块

## 1. 模块概述

本模块是平台的核心业务闭环，涉及资金流转，包括：
- 企业发布用工需求
- 临工报名应聘
- 平台分配人员（含临时管理员）
- 驻厂监管（打卡、工时/计件记录）
- 工资结算与提现

**重要**：企业发布用工需求**免费**，平台通过工资抽成盈利。

---

## 2. 角色定义

| 角色 | 说明 | 主要操作 |
|-----|------|---------|
| 工厂（企业用户） | 发布用工需求的企业 | 发布需求、支付工资 |
| 临工 | 应聘干活的临时工 | 浏览需求、报名、打卡、提现 |
| 临时管理员 | 从报名临工中指定的监管者 | 驻厂监管、核验签到、记录工时/计件、上报异常 |
| 平台管理员 | 后台运营人员 | 审核需求、分配人员、处理纠纷、配置抽成比例 |

---

## 3. 用工需求发布

### 3.1 发布表单字段

| 字段 | 必填 | 说明 |
|-----|------|------|
| 标题 | ✅ | 简明描述用工内容 |
| 工种 | ✅ | 下拉选择（后台配置工种列表） |
| 结算方式 | ✅ | 计时 / 计件（根据工种有默认值，可修改） |
| 工资单价 | ✅ | 计时：元/小时；计件：元/件 |
| 需求人数 | ✅ | 数字 |
| 工作内容 | ✅ | 文本描述 |
| 工作时间 | ✅ | 开始日期、结束日期、每日工作时段 |
| 工作地点 | ✅ | 省市区 + 详细地址 + 地图定位 |
| 技能要求 | ❌ | 如"持有焊工证" |
| 其他说明 | ❌ | |
| 图片 | ❌ | 工作环境图，最多9张 |
| 联系人 | ✅ | 默认取认证信息 |
| 联系电话 | ✅ | 默认取认证信息 |

### 3.2 工资与抽成机制

```
┌─────────────────────────────────────────────────────────────┐
│                    工资抽成示意                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   工厂设定工资：25元/小时                                    │
│         │                                                   │
│         ▼                                                   │
│   ┌─────────────────────────────────────┐                  │
│   │  平台抽成比例：20%（后台可配置）      │                  │
│   │  默认值全局统一，可针对单个需求修改   │                  │
│   └─────────────────────────────────────┘                  │
│         │                                                   │
│         ▼                                                   │
│   临工看到的工资：25 × (1-20%) = 20元/小时                  │
│                                                             │
│   结算时：                                                   │
│   - 工厂支付：25元/小时 × 实际工时                          │
│   - 平台收入：5元/小时 × 实际工时                           │
│   - 临工收入：20元/小时 × 实际工时                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**配置说明**：
- 后台设置**默认抽成比例**（全局生效）
- 管理员可针对**单个用工需求**修改抽成比例
- 临工端只显示扣除抽成后的工资

### 3.3 发布流程

```
企业点击发布用工需求
        │
        ▼
   检查认证状态 ──→ 未认证 ──→ 提示去认证
        │ 已认证
        ▼
   填写表单
        │
        ▼
   点击提交
        │
        ▼
   关键词检查 ──→ 触发敏感词 ──→ 提示修改
        │ 通过
        ▼
   审核模式判断
        │
   ┌────┴────┐
   ▼         ▼
自动审核   人工审核
   │         │
   ▼         ▼
直接发布   待审核状态
   │         │
   └────┬────┘
        │
        ▼
   临工端可见
   开始接受报名
```

---

## 4. 临工浏览与报名

### 4.1 用工列表页

```
┌─────────────────────────────────────────┐
│  🔍 搜索框                              │
│  [输入工种/地区搜索...]                  │
├─────────────────────────────────────────┤
│  筛选条件                               │
│  [工种 ▼] [地区 ▼] [结算方式 ▼]         │
│  默认按距离排序                          │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────┐   │
│  │ 🔧 组装工                        │   │
│  │ 💰 20元/小时                     │   │
│  │ 📍 2.5km | 广州市白云区          │   │
│  │ 👥 需要10人 | 已报名5人          │   │
│  │ 📅 1月20日 - 1月25日            │   │
│  │ [查看详情]                       │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

**注意**：临工看到的工资是**扣除平台抽成后**的金额。

### 4.2 用工详情页

```
┌─────────────────────────────────────────┐
│  [返回]              [举报]             │
├─────────────────────────────────────────┤
│  📷 工作环境图片                        │
├─────────────────────────────────────────┤
│  🔧 组装工                              │
│  💰 20元/小时（计时）                   │
│  📍 广州市白云区xxx路xxx号              │
│     距离您 2.5km                        │
├─────────────────────────────────────────┤
│  工作详情                               │
│  ─────────────────────                  │
│  需求人数：10人                         │
│  已报名：5人                            │
│  工作时间：1月20日 - 1月25日            │
│           每天 08:00 - 18:00           │
│  工作内容：xxxxxxxxxxxxx                │
│  技能要求：xxxxxxxxxxxxx                │
├─────────────────────────────────────────┤
│  联系方式                               │
│  ─────────────────────                  │
│  联系人：张经理                         │
│  电话：138xxxx1234                      │
│  （临工免费查看，无需消耗查看机会）       │
├─────────────────────────────────────────┤
│  工厂信用分：⭐ 92分                    │
├─────────────────────────────────────────┤
│  [我要报名]                             │
└─────────────────────────────────────────┘
```

### 4.3 报名流程

```
点击"我要报名"
      │
      ▼
 检查认证状态 ──→ 未认证 ──→ 提示去认证
      │ 已认证
      ▼
 检查是否已报名 ──→ 已报名 ──→ 提示"您已报名"
      │ 未报名
      ▼
 检查时间冲突 ──→ 有冲突 ──→ 提示时间冲突
      │ 无冲突
      ▼
 提交报名
      │
      ▼
 进入报名列表
 状态：待分配
      │
      ▼
 推送消息通知
```

### 4.4 超额报名机制

| 配置项 | 说明 | 默认值 |
|-------|------|--------|
| 超额报名比例 | 允许报名人数 = 需求人数 × (1 + 比例) | 50%（后台可配） |

**示例**：需要10人，允许报名15人（10 × 1.5）

---

## 5. 人员分配

### 5.1 分配流程

```
┌─────────────────────────────────────────────────────────────┐
│                      人员分配流程                            │
└─────────────────────────────────────────────────────────────┘

1. 报名截止（或管理员手动触发分配）
         │
         ▼
2. 平台管理员在后台查看报名列表
   ┌─────────────────────────────────────────┐
   │  报名列表                               │
   │  ┌─────────────────────────────────┐   │
   │  │ 姓名 | 信用分 | 接单数 | 距离    │   │
   │  │ 张三 | 95分   | 50单  | 1.2km  │   │
   │  │ 李四 | 88分   | 30单  | 2.5km  │   │
   │  │ 王五 | 92分   | 45单  | 0.8km  │   │
   │  │ ...                             │   │
   │  └─────────────────────────────────┘   │
   └─────────────────────────────────────────┘
         │
         ▼
3. 指定临时管理员（从符合条件的报名者中选择）
   条件：累计接单≥10单、好评率≥95%、无违规记录
         │
         ▼
4. 确定入选临工名单（根据需求人数）
         │
         ▼
5. 系统推送通知
   - 入选者：收到"入选通知"
   - 落选者：收到"落选通知"
   - 临时管理员：收到"管理员任命通知"
```

### 5.2 临时管理员资格条件

| 条件 | 要求 | 说明 |
|-----|------|------|
| 累计接单数 | ≥10单 | 后台可配置 |
| 信用分 | ≥95分 | 后台可配置 |
| 违规记录 | 无 | 包括线下交易、工时造假、恶意投诉等 |

### 5.3 临时管理员收益

```
临时管理员收益 = 正常工资 + 监管服务费

监管服务费 = 监管人数 × 单价 × 工时/件数

单价：后台可配置，可针对单个订单调整
```

---

## 6. 出勤确认

### 6.1 确认流程

```
开工前一天
    │
    ▼
系统推送"出勤确认"提醒
    │
    ▼
临工点击"确认出勤"
    │
    ├──→ 已确认：状态变为"待出勤"
    │
    └──→ 未确认（截止时间前）：
              │
              ▼
         释放名额
         候补递补
         推送"您已被取消资格"通知
```

### 6.2 确认时间配置

| 配置项 | 说明 | 默认值 |
|-------|------|--------|
| 确认提醒时间 | 开工前N小时推送提醒 | 24小时（后台可配） |
| 确认截止时间 | 开工前N小时必须确认 | 12小时（后台可配） |

### 6.3 爽约惩罚

| 行为 | 惩罚 |
|-----|------|
| 确认出勤但未到场 | 扣信用分10分 |
| 累计爽约3次 | 扣信用分20分 + 限制报名7天 |
| 累计爽约5次以上 | 封号 |

---

## 7. 驻厂监管

### 7.1 临时管理员职责

| 阶段 | 职责 | 操作 |
|-----|------|------|
| 开工前 | 核验到场临工身份 | 扫码/核对订单码签到 |
| 开工时 | 点击"批量开工确认" | 确认实际到场人数 |
| 工作中（计时） | 每2小时上传现场照片 | 拍照上传 |
| 工作中（计件） | 记录完成数量 | 录入计件数 |
| 收工时 | 核对工时/计件，生成核验单 | 提交结算 |
| 异常情况 | 上报违规行为 | 拍照取证、提交异常报告 |

### 7.2 开工签到

```
┌─────────────────────────────────────────┐
│  开工签到                               │
├─────────────────────────────────────────┤
│  用工需求：组装工 - xxx公司              │
│  应到人数：10人                         │
├─────────────────────────────────────────┤
│  签到列表                               │
│  ┌─────────────────────────────────┐   │
│  │ ☑️ 张三 - 已签到 08:02          │   │
│  │ ☑️ 李四 - 已签到 08:05          │   │
│  │ ☐ 王五 - 未签到                 │   │
│  │ ...                             │   │
│  └─────────────────────────────────┘   │
│  实到人数：8人 / 应到：10人             │
├─────────────────────────────────────────┤
│  [确认开工]                             │
│  （未签到的临工将不计入工时）            │
└─────────────────────────────────────────┘
```

### 7.3 工时记录（计时模式）

```
┌─────────────────────────────────────────┐
│  工时记录                               │
├─────────────────────────────────────────┤
│  当前状态：工作中                        │
│  已工作：4小时30分钟                     │
├─────────────────────────────────────────┤
│  现场照片（每2小时上传）                 │
│  ┌───────┐ ┌───────┐ ┌───────┐        │
│  │ 10:00 │ │ 12:00 │ │ 14:00 │        │
│  │  ✅   │ │  ✅   │ │ 待上传 │        │
│  └───────┘ └───────┘ └───────┘        │
│  [上传照片]                             │
├─────────────────────────────────────────┤
│  异常记录                               │
│  [+ 记录中途离岗]                       │
│  [+ 记录换岗]                           │
├─────────────────────────────────────────┤
│  [确认收工]                             │
└─────────────────────────────────────────┘
```

### 7.4 计件记录（计件模式）

```
┌─────────────────────────────────────────┐
│  计件记录                               │
├─────────────────────────────────────────┤
│  临工列表                               │
│  ┌─────────────────────────────────┐   │
│  │ 姓名   | 今日计件 | 累计计件     │   │
│  │ 张三   | 150件   | 450件       │   │
│  │ 李四   | 120件   | 380件       │   │
│  │ [录入] | [录入]  |             │   │
│  └─────────────────────────────────┘   │
├─────────────────────────────────────────┤
│  [提交今日计件]                         │
│  （需工厂现场负责人确认）                │
└─────────────────────────────────────────┘
```

### 7.5 异常上报

```
┌─────────────────────────────────────────┐
│  异常上报                               │
├─────────────────────────────────────────┤
│  异常类型（单选）                        │
│  ○ 临工旷工                             │
│  ○ 临工早退                             │
│  ○ 临工虚报工时/计件                    │
│  ○ 临工消极怠工                         │
│  ○ 工厂诱导线下结算                     │
│  ○ 工厂克扣工时                         │
│  ○ 工厂提供不安全工作环境               │
│  ○ 其他                                 │
├─────────────────────────────────────────┤
│  涉及人员                               │
│  [选择临工/工厂]                        │
├─────────────────────────────────────────┤
│  情况描述                               │
│  [文本输入框]                           │
├─────────────────────────────────────────┤
│  证据上传                               │
│  [+ 添加照片]                           │
├─────────────────────────────────────────┤
│  [提交上报]                             │
└─────────────────────────────────────────┘
```

---

## 8. 收工结算

### 8.1 结算流程

```
临时管理员点击"确认收工"
         │
         ▼
   生成工时/计件核验单
         │
         ▼
┌─────────────────────────────────────────┐
│  核验单                                 │
│  ─────────────────────                  │
│  用工需求：组装工                        │
│  工作日期：2026-01-20                   │
│  结算方式：计时                          │
│  ─────────────────────                  │
│  姓名   | 工时   | 应付工资（临工）       │
│  张三   | 8小时  | ¥160                 │
│  李四   | 7.5小时| ¥150                 │
│  ...                                    │
│  ─────────────────────                  │
│  合计工时：75小时                        │
│  临工应付总额：¥1500                    │
│  工厂应付总额：¥1875（含平台抽成）       │
│  平台收入：¥375                         │
└─────────────────────────────────────────┘
         │
         ▼
   临工确认（可选，超时自动确认）
         │
         ▼
   核验单生效
   状态变为"待工厂付款"
         │
         ▼
   推送工厂付款通知
```

### 8.2 工厂付款

```
工厂收到付款通知
      │
      ▼
 查看核验单详情
      │
      ▼
 点击"立即支付"
      │
      ▼
 微信支付
      │
      ▼
 支付成功
      │
      ▼
 系统自动分账：
 - 平台收入入账
 - 临工余额增加
      │
      ▼
 推送临工"工资到账"通知
```

### 8.3 结算状态

| 状态 | 说明 |
|-----|------|
| 待确认 | 临时管理员已提交，等待临工确认 |
| 待付款 | 核验单已确认，等待工厂付款 |
| 已付款 | 工厂已支付，临工可提现 |
| 已完成 | 临工已提现 |

---

## 9. 临工端状态流转

### 9.1 报名状态

```
报名 ──→ 待分配 ──→ 入选 ──→ 待出勤确认 ──→ 已确认 ──→ 进行中 ──→ 待结算 ──→ 已完成
                    │
                    └──→ 落选
```

### 9.2 "我的报名"页面

```
┌─────────────────────────────────────────┐
│  我的报名                               │
├─────────────────────────────────────────┤
│  [待确认] [已入选] [进行中] [已完成]     │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────┐   │
│  │ 🔧 组装工 - xxx公司              │   │
│  │ 状态：已入选 ✅                  │   │
│  │ 工作时间：1月20日 08:00          │   │
│  │ [确认出勤]                       │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

---

## 10. 接口清单

| 接口 | 方法 | 说明 |
|-----|------|------|
| /api/job/publish | POST | 发布用工需求 |
| /api/job/list | GET | 获取用工列表（临工端） |
| /api/job/detail/:id | GET | 获取用工详情 |
| /api/job/apply | POST | 报名应聘 |
| /api/job/my-applications | GET | 我的报名列表 |
| /api/job/confirm-attendance | POST | 确认出勤 |
| /api/job/checkin | POST | 签到（临时管理员） |
| /api/job/start-work | POST | 确认开工（临时管理员） |
| /api/job/upload-photo | POST | 上传现场照片 |
| /api/job/record-piece | POST | 录入计件数 |
| /api/job/end-work | POST | 确认收工 |
| /api/job/report-issue | POST | 异常上报 |
| /api/job/settlement/:id | GET | 获取结算单 |
| /api/job/confirm-settlement | POST | 临工确认结算 |
| /api/job/pay | POST | 工厂支付工资 |
