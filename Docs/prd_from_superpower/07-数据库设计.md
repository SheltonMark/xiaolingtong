# 数据库设计

## 1. 数据库选型

- **主数据库**：MySQL 8.0+
- **缓存数据库**：Redis

---

## 2. 表结构设计

### 2.1 用户相关表

#### users - 用户基础表
```sql
CREATE TABLE users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  openid VARCHAR(64) NOT NULL UNIQUE COMMENT '微信openid',
  union_id VARCHAR(64) COMMENT '微信unionid',
  user_type ENUM('enterprise', 'worker') NOT NULL COMMENT '用户类型：企业/临工',
  nickname VARCHAR(64) COMMENT '微信昵称',
  avatar VARCHAR(255) COMMENT '头像URL',
  phone VARCHAR(20) COMMENT '手机号',
  cert_status ENUM('pending', 'submitted', 'approved', 'rejected') DEFAULT 'pending' COMMENT '认证状态',
  account_status ENUM('normal', 'limited', 'disabled') DEFAULT 'normal' COMMENT '账号状态',
  credit_score INT DEFAULT 80 COMMENT '信用分',
  member_type ENUM('normal', 'monthly', 'yearly') DEFAULT 'normal' COMMENT '会员类型',
  member_expire_time DATETIME COMMENT '会员到期时间',
  view_chances INT DEFAULT 0 COMMENT '剩余查看机会（冗余字段，实际以view_chances表为准）',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_openid (openid),
  INDEX idx_user_type (user_type),
  INDEX idx_cert_status (cert_status)
) COMMENT '用户基础表';
```

#### enterprise_cert - 企业认证信息表
```sql
CREATE TABLE enterprise_cert (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '用户ID',
  company_name VARCHAR(128) NOT NULL COMMENT '企业名称',
  credit_code VARCHAR(32) NOT NULL COMMENT '统一社会信用代码',
  license_image VARCHAR(255) NOT NULL COMMENT '营业执照图片',
  legal_person_name VARCHAR(32) COMMENT '法人姓名',
  legal_person_id_front VARCHAR(255) NOT NULL COMMENT '法人身份证正面',
  legal_person_id_back VARCHAR(255) NOT NULL COMMENT '法人身份证反面',
  contact_name VARCHAR(32) NOT NULL COMMENT '联系人姓名',
  contact_phone VARCHAR(20) NOT NULL COMMENT '联系人手机',
  contact_wechat VARCHAR(64) COMMENT '联系人微信',
  company_type ENUM('factory', 'trade_factory', 'ecommerce', 'trading', 'store', 'other') NOT NULL COMMENT '企业分类',
  industry_category VARCHAR(32) NOT NULL COMMENT '一级行业分类',
  product_tags JSON COMMENT '二级品类标签',
  attribute_tags JSON COMMENT '属性标签',
  province VARCHAR(32) COMMENT '省',
  city VARCHAR(32) COMMENT '市',
  district VARCHAR(32) COMMENT '区',
  address VARCHAR(255) COMMENT '详细地址',
  reject_reason VARCHAR(255) COMMENT '驳回原因',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE INDEX idx_user_id (user_id),
  INDEX idx_company_name (company_name)
) COMMENT '企业认证信息表';
```

#### worker_cert - 临工认证信息表
```sql
CREATE TABLE worker_cert (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '用户ID',
  real_name VARCHAR(32) NOT NULL COMMENT '真实姓名',
  id_number VARCHAR(32) NOT NULL COMMENT '身份证号',
  id_front_image VARCHAR(255) NOT NULL COMMENT '身份证正面',
  id_back_image VARCHAR(255) NOT NULL COMMENT '身份证反面',
  reject_reason VARCHAR(255) COMMENT '驳回原因',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE INDEX idx_user_id (user_id)
) COMMENT '临工认证信息表';
```

### 2.2 供需信息表

#### info_posts - 信息发布表
```sql
CREATE TABLE info_posts (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '发布者ID',
  info_type ENUM('purchase', 'inventory', 'processing') NOT NULL COMMENT '信息类型：采购/库存/代加工',
  title VARCHAR(128) NOT NULL COMMENT '标题',
  content JSON NOT NULL COMMENT '详细内容（JSON格式存储各类型特有字段）',
  images JSON COMMENT '图片列表',
  contact_name VARCHAR(32) NOT NULL COMMENT '联系人',
  contact_phone VARCHAR(20) NOT NULL COMMENT '联系电话',
  contact_wechat VARCHAR(64) COMMENT '联系微信',
  province VARCHAR(32) COMMENT '省',
  city VARCHAR(32) COMMENT '市',
  district VARCHAR(32) COMMENT '区',
  status ENUM('pending', 'approved', 'rejected', 'offline') DEFAULT 'pending' COMMENT '状态',
  reject_reason VARCHAR(255) COMMENT '驳回原因',
  expire_time DATETIME NOT NULL COMMENT '有效期',
  is_top TINYINT(1) DEFAULT 0 COMMENT '是否置顶',
  top_expire_time DATETIME COMMENT '置顶到期时间',
  view_count INT DEFAULT 0 COMMENT '浏览次数',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id),
  INDEX idx_info_type (info_type),
  INDEX idx_status (status),
  INDEX idx_city (city),
  INDEX idx_created_at (created_at)
) COMMENT '信息发布表';
```

#### contact_views - 联系方式查看记录表
```sql
CREATE TABLE contact_views (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '查看者ID',
  post_id BIGINT NOT NULL COMMENT '信息ID',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE INDEX idx_user_post (user_id, post_id),
  INDEX idx_user_id (user_id)
) COMMENT '联系方式查看记录表';
```

### 2.3 用工相关表

#### job_posts - 用工需求表
```sql
CREATE TABLE job_posts (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '发布者ID（工厂）',
  title VARCHAR(128) NOT NULL COMMENT '标题',
  job_type_id BIGINT NOT NULL COMMENT '工种ID',
  settlement_type ENUM('hourly', 'piece') NOT NULL COMMENT '结算方式：计时/计件',
  factory_price DECIMAL(10,2) NOT NULL COMMENT '工厂设定单价',
  worker_price DECIMAL(10,2) NOT NULL COMMENT '临工看到的单价（扣除抽成后）',
  commission_rate DECIMAL(5,4) NOT NULL COMMENT '抽成比例',
  required_count INT NOT NULL COMMENT '需求人数',
  work_content TEXT NOT NULL COMMENT '工作内容',
  work_start_date DATE NOT NULL COMMENT '工作开始日期',
  work_end_date DATE NOT NULL COMMENT '工作结束日期',
  work_start_time TIME NOT NULL COMMENT '每日开始时间',
  work_end_time TIME NOT NULL COMMENT '每日结束时间',
  province VARCHAR(32) NOT NULL,
  city VARCHAR(32) NOT NULL,
  district VARCHAR(32) NOT NULL,
  address VARCHAR(255) NOT NULL COMMENT '详细地址',
  latitude DECIMAL(10,7) COMMENT '纬度',
  longitude DECIMAL(10,7) COMMENT '经度',
  skill_requirement VARCHAR(255) COMMENT '技能要求',
  other_info TEXT COMMENT '其他说明',
  images JSON COMMENT '图片列表',
  contact_name VARCHAR(32) NOT NULL,
  contact_phone VARCHAR(20) NOT NULL,
  status ENUM('pending', 'approved', 'rejected', 'recruiting', 'assigned', 'working', 'settling', 'paying', 'completed', 'cancelled') DEFAULT 'pending' COMMENT '状态',
  reject_reason VARCHAR(255) COMMENT '驳回原因',
  supervisor_id BIGINT COMMENT '临时管理员ID',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id),
  INDEX idx_status (status),
  INDEX idx_city (city),
  INDEX idx_job_type (job_type_id)
) COMMENT '用工需求表';
```

#### job_applications - 用工报名表
```sql
CREATE TABLE job_applications (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  job_id BIGINT NOT NULL COMMENT '用工需求ID',
  worker_id BIGINT NOT NULL COMMENT '临工ID',
  status ENUM('applied', 'selected', 'rejected', 'confirmed', 'working', 'completed') DEFAULT 'applied' COMMENT '状态',
  is_supervisor TINYINT(1) DEFAULT 0 COMMENT '是否为临时管理员',
  attendance_confirmed TINYINT(1) DEFAULT 0 COMMENT '是否确认出勤',
  attendance_confirmed_at DATETIME COMMENT '确认出勤时间',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE INDEX idx_job_worker (job_id, worker_id),
  INDEX idx_worker_id (worker_id),
  INDEX idx_status (status)
) COMMENT '用工报名表';
```

#### job_checkins - 打卡签到表
```sql
CREATE TABLE job_checkins (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  job_id BIGINT NOT NULL COMMENT '用工需求ID',
  worker_id BIGINT NOT NULL COMMENT '临工ID',
  checkin_date DATE NOT NULL COMMENT '签到日期',
  checkin_time DATETIME COMMENT '签到时间',
  checkout_time DATETIME COMMENT '签退时间',
  actual_hours DECIMAL(5,2) COMMENT '实际工时',
  piece_count INT COMMENT '计件数量',
  status ENUM('checked_in', 'working', 'checked_out') DEFAULT 'checked_in',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE INDEX idx_job_worker_date (job_id, worker_id, checkin_date),
  INDEX idx_job_id (job_id)
) COMMENT '打卡签到表';
```

#### job_photos - 现场照片表
```sql
CREATE TABLE job_photos (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  job_id BIGINT NOT NULL COMMENT '用工需求ID',
  uploader_id BIGINT NOT NULL COMMENT '上传者ID（临时管理员）',
  photo_url VARCHAR(255) NOT NULL COMMENT '照片URL',
  upload_time DATETIME NOT NULL COMMENT '上传时间',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_job_id (job_id)
) COMMENT '现场照片表';
```

#### job_issues - 异常上报表
```sql
CREATE TABLE job_issues (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  job_id BIGINT NOT NULL COMMENT '用工需求ID',
  reporter_id BIGINT NOT NULL COMMENT '上报者ID',
  issue_type VARCHAR(32) NOT NULL COMMENT '异常类型',
  target_type ENUM('worker', 'factory') NOT NULL COMMENT '涉及对象类型',
  target_id BIGINT NOT NULL COMMENT '涉及对象ID',
  description TEXT NOT NULL COMMENT '情况描述',
  evidence_images JSON COMMENT '证据图片',
  status ENUM('pending', 'processing', 'resolved') DEFAULT 'pending',
  handle_result TEXT COMMENT '处理结果',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_job_id (job_id),
  INDEX idx_status (status)
) COMMENT '异常上报表';
```

#### job_settlements - 结算单表
```sql
CREATE TABLE job_settlements (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  job_id BIGINT NOT NULL COMMENT '用工需求ID',
  settlement_date DATE NOT NULL COMMENT '结算日期',
  total_workers INT NOT NULL COMMENT '总人数',
  total_hours DECIMAL(10,2) COMMENT '总工时',
  total_pieces INT COMMENT '总计件',
  worker_total_amount DECIMAL(12,2) NOT NULL COMMENT '临工应付总额',
  platform_commission DECIMAL(12,2) NOT NULL COMMENT '平台抽成',
  supervisor_fee DECIMAL(12,2) DEFAULT 0 COMMENT '管理员服务费',
  factory_pay_amount DECIMAL(12,2) NOT NULL COMMENT '工厂应付总额',
  status ENUM('pending_confirm', 'confirmed', 'paid') DEFAULT 'pending_confirm',
  confirmed_at DATETIME COMMENT '确认时间',
  paid_at DATETIME COMMENT '支付时间',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_job_id (job_id),
  INDEX idx_status (status)
) COMMENT '结算单表';
```

#### job_settlement_details - 结算明细表
```sql
CREATE TABLE job_settlement_details (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  settlement_id BIGINT NOT NULL COMMENT '结算单ID',
  worker_id BIGINT NOT NULL COMMENT '临工ID',
  hours DECIMAL(5,2) COMMENT '工时',
  pieces INT COMMENT '计件数',
  amount DECIMAL(10,2) NOT NULL COMMENT '应付金额',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_settlement_id (settlement_id),
  INDEX idx_worker_id (worker_id)
) COMMENT '结算明细表';
```

### 2.4 财务相关表

#### view_chances - 查看机会表
```sql
CREATE TABLE view_chances (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '用户ID',
  source ENUM('register', 'purchase', 'share') NOT NULL COMMENT '来源',
  amount INT NOT NULL COMMENT '数量',
  used INT DEFAULT 0 COMMENT '已使用',
  expire_time DATETIME NOT NULL COMMENT '过期时间',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id),
  INDEX idx_expire_time (expire_time)
) COMMENT '查看机会表';
```

#### wallet - 钱包表（临工）
```sql
CREATE TABLE wallet (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '用户ID',
  balance DECIMAL(12,2) DEFAULT 0 COMMENT '可提现余额',
  total_income DECIMAL(12,2) DEFAULT 0 COMMENT '累计收入',
  total_withdraw DECIMAL(12,2) DEFAULT 0 COMMENT '累计提现',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE INDEX idx_user_id (user_id)
) COMMENT '钱包表';
```

#### wallet_transactions - 钱包流水表
```sql
CREATE TABLE wallet_transactions (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '用户ID',
  type ENUM('income', 'withdraw', 'supervisor_fee') NOT NULL COMMENT '类型',
  amount DECIMAL(10,2) NOT NULL COMMENT '金额',
  balance_after DECIMAL(12,2) NOT NULL COMMENT '交易后余额',
  related_job_id BIGINT COMMENT '关联用工ID',
  description VARCHAR(255) COMMENT '描述',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id),
  INDEX idx_created_at (created_at)
) COMMENT '钱包流水表';
```

#### withdrawals - 提现记录表
```sql
CREATE TABLE withdrawals (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '用户ID',
  amount DECIMAL(10,2) NOT NULL COMMENT '提现金额',
  status ENUM('pending', 'processing', 'success', 'failed') DEFAULT 'pending',
  wechat_order_no VARCHAR(64) COMMENT '微信订单号',
  fail_reason VARCHAR(255) COMMENT '失败原因',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id),
  INDEX idx_status (status)
) COMMENT '提现记录表';
```

#### orders - 订单表（会员/查看机会/广告/置顶）
```sql
CREATE TABLE orders (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  order_no VARCHAR(64) NOT NULL UNIQUE COMMENT '订单号',
  user_id BIGINT NOT NULL COMMENT '用户ID',
  order_type ENUM('member', 'view_chance', 'ad', 'promote') NOT NULL COMMENT '订单类型',
  amount DECIMAL(10,2) NOT NULL COMMENT '金额',
  product_info JSON NOT NULL COMMENT '商品信息',
  status ENUM('pending', 'paid', 'cancelled', 'refunded') DEFAULT 'pending',
  paid_at DATETIME COMMENT '支付时间',
  wechat_order_no VARCHAR(64) COMMENT '微信支付订单号',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id),
  INDEX idx_order_no (order_no),
  INDEX idx_status (status)
) COMMENT '订单表';
```

#### salary_payments - 工资支付记录表
```sql
CREATE TABLE salary_payments (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  settlement_id BIGINT NOT NULL COMMENT '结算单ID',
  job_id BIGINT NOT NULL COMMENT '用工需求ID',
  factory_user_id BIGINT NOT NULL COMMENT '工厂用户ID',
  amount DECIMAL(12,2) NOT NULL COMMENT '支付金额',
  status ENUM('pending', 'paid', 'failed') DEFAULT 'pending',
  wechat_order_no VARCHAR(64) COMMENT '微信支付订单号',
  paid_at DATETIME COMMENT '支付时间',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_settlement_id (settlement_id),
  INDEX idx_job_id (job_id)
) COMMENT '工资支付记录表';
```

### 2.5 广告相关表

#### advertisements - 广告表
```sql
CREATE TABLE advertisements (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT COMMENT '用户ID（平台广告为空）',
  ad_position ENUM('banner', 'recommend') NOT NULL COMMENT '广告位置',
  image_url VARCHAR(255) NOT NULL COMMENT '广告图片',
  link_type ENUM('post', 'external') NOT NULL COMMENT '跳转类型',
  link_url VARCHAR(255) COMMENT '跳转链接',
  link_post_id BIGINT COMMENT '跳转信息ID',
  start_date DATE NOT NULL COMMENT '开始日期',
  end_date DATE NOT NULL COMMENT '结束日期',
  status ENUM('pending', 'approved', 'rejected', 'active', 'expired') DEFAULT 'pending',
  is_platform TINYINT(1) DEFAULT 0 COMMENT '是否平台广告',
  order_id BIGINT COMMENT '关联订单ID',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_status (status),
  INDEX idx_position (ad_position),
  INDEX idx_date (start_date, end_date)
) COMMENT '广告表';
```

### 2.6 消息相关表

#### messages - 消息表
```sql
CREATE TABLE messages (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '接收用户ID',
  category ENUM('system', 'business') NOT NULL COMMENT '消息分类',
  title VARCHAR(64) NOT NULL COMMENT '标题',
  content TEXT NOT NULL COMMENT '内容',
  link_type VARCHAR(32) COMMENT '跳转类型',
  link_id BIGINT COMMENT '跳转ID',
  is_read TINYINT(1) DEFAULT 0 COMMENT '是否已读',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id),
  INDEX idx_is_read (is_read),
  INDEX idx_created_at (created_at)
) COMMENT '消息表';
```

#### wechat_subscriptions - 微信订阅状态表
```sql
CREATE TABLE wechat_subscriptions (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '用户ID',
  template_type VARCHAR(32) NOT NULL COMMENT '模板类型',
  is_authorized TINYINT(1) DEFAULT 0 COMMENT '是否授权',
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE INDEX idx_user_template (user_id, template_type)
) COMMENT '微信订阅状态表';
```

### 2.7 举报与曝光表

#### reports - 举报表
```sql
CREATE TABLE reports (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  reporter_id BIGINT NOT NULL COMMENT '举报人ID',
  target_type ENUM('post', 'user') NOT NULL COMMENT '举报对象类型',
  target_id BIGINT NOT NULL COMMENT '举报对象ID',
  reason VARCHAR(32) NOT NULL COMMENT '举报原因',
  description TEXT COMMENT '补充说明',
  evidence_images JSON COMMENT '证据图片',
  status ENUM('pending', 'processing', 'resolved', 'rejected') DEFAULT 'pending',
  handle_result TEXT COMMENT '处理结果',
  handler_id BIGINT COMMENT '处理人ID',
  handled_at DATETIME COMMENT '处理时间',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_status (status),
  INDEX idx_target (target_type, target_id)
) COMMENT '举报表';
```

#### blacklist - 诚信曝光表
```sql
CREATE TABLE blacklist (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '被曝光用户ID',
  reason VARCHAR(32) NOT NULL COMMENT '曝光原因',
  description TEXT COMMENT '详细说明',
  evidence_images JSON COMMENT '证据图片',
  operator_id BIGINT NOT NULL COMMENT '操作人ID',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id)
) COMMENT '诚信曝光表';
```

### 2.8 配置表

#### system_config - 系统配置表
```sql
CREATE TABLE system_config (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  config_key VARCHAR(64) NOT NULL UNIQUE COMMENT '配置键',
  config_value TEXT NOT NULL COMMENT '配置值',
  config_type ENUM('string', 'number', 'json', 'boolean') DEFAULT 'string',
  description VARCHAR(255) COMMENT '配置说明',
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT '系统配置表';
```

#### job_types - 工种表
```sql
CREATE TABLE job_types (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(32) NOT NULL COMMENT '工种名称',
  default_settlement ENUM('hourly', 'piece') DEFAULT 'hourly' COMMENT '默认结算方式',
  is_active TINYINT(1) DEFAULT 1 COMMENT '是否启用',
  sort_order INT DEFAULT 0 COMMENT '排序',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT '工种表';
```

#### open_cities - 开放城市表
```sql
CREATE TABLE open_cities (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  province VARCHAR(32) NOT NULL,
  city VARCHAR(32) NOT NULL,
  is_active TINYINT(1) DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE INDEX idx_city (province, city)
) COMMENT '开放城市表';
```

#### keywords_blacklist - 关键词黑名单表
```sql
CREATE TABLE keywords_blacklist (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  keyword VARCHAR(64) NOT NULL UNIQUE COMMENT '关键词',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
) COMMENT '关键词黑名单表';
```

#### categories - 分类标签表
```sql
CREATE TABLE categories (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  parent_id BIGINT DEFAULT 0 COMMENT '父级ID，0为一级分类',
  name VARCHAR(64) NOT NULL COMMENT '分类名称',
  type ENUM('industry', 'product', 'attribute') NOT NULL COMMENT '分类类型',
  is_active TINYINT(1) DEFAULT 1,
  sort_order INT DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_parent (parent_id),
  INDEX idx_type (type)
) COMMENT '分类标签表';
```

### 2.9 管理员表

#### admin_users - 管理员表
```sql
CREATE TABLE admin_users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(32) NOT NULL UNIQUE COMMENT '用户名',
  password VARCHAR(128) NOT NULL COMMENT '密码（加密）',
  real_name VARCHAR(32) COMMENT '真实姓名',
  role ENUM('super', 'auditor', 'finance', 'operator') NOT NULL COMMENT '角色',
  is_active TINYINT(1) DEFAULT 1,
  last_login_at DATETIME COMMENT '最后登录时间',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT '管理员表';
```

---

## 3. Redis 数据结构

### 3.1 会话缓存
```
Key: session:{token}
Value: JSON { userId, userType, ... }
TTL: 7天
```

### 3.2 查看机会计数
```
Key: view_chances:{userId}
Value: 剩余次数（冗余缓存，加速查询）
TTL: 无（数据变更时更新）
```

### 3.3 未读消息数
```
Key: unread_msg:{userId}
Value: 未读数量
TTL: 无（消息变更时更新）
```

### 3.4 热点数据缓存
```
Key: config:{configKey}
Value: 配置值
TTL: 1小时

Key: job_types
Value: JSON 工种列表
TTL: 1小时

Key: open_cities
Value: JSON 开放城市列表
TTL: 1小时
```

---

## 4. 索引设计说明

### 4.1 索引原则
- 主键使用自增BIGINT
- 外键字段建立索引
- 常用查询条件字段建立索引
- 状态字段建立索引
- 时间字段建立索引（用于排序和范围查询）

### 4.2 联合索引
- `contact_views (user_id, post_id)` - 防止重复查看
- `job_applications (job_id, worker_id)` - 防止重复报名
- `job_checkins (job_id, worker_id, checkin_date)` - 每日唯一签到
