# 小灵通 - 工厂贸易供需对接平台

## 项目概述

### 项目名称
小灵通 - 工厂贸易供需对接小程序

### 核心定位
聚焦**外贸采购、工厂库存、临时用工、代加工服务**四大场景，打造工厂与贸易商、工人的双向精准匹配平台。

### 目标用户
- **企业用户**：工厂、工贸一体、电商、贸易公司、门店、其他单位
- **临工用户**：临时工人

### 核心价值
打破供需信息壁垒，实现工厂产能、库存、用工需求与贸易采购、代加工需求的高效对接。

---

## 技术架构

### 技术栈
| 层级 | 技术选型 |
|-----|---------|
| 前端（用户端） | 微信原生小程序 |
| 前端（管理端） | 独立Web后台（PC端） |
| 后端 | Node.js (Express/Koa/NestJS) |
| 数据库 | MySQL + Redis |
| 支付 | 微信支付（需微信商户号） |
| 存储 | 图片云存储 |
| 定位 | 微信小程序定位API |

### 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户层                                   │
├─────────────────────────────────┬───────────────────────────────┤
│      微信小程序（用户端）         │       Web后台（管理端）        │
│  ┌───────────┬───────────┐     │                               │
│  │ 企业用户   │ 临工用户   │     │      平台管理员               │
│  └───────────┴───────────┘     │                               │
└─────────────────────────────────┴───────────────────────────────┘
                    │                           │
                    ▼                           ▼
┌─────────────────────────────────────────────────────────────────┐
│                       API 网关层                                 │
│              统一鉴权、限流、日志、错误处理                        │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       业务服务层                                 │
├───────────┬───────────┬───────────┬───────────┬─────────────────┤
│ 用户服务   │ 信息服务   │ 用工服务   │ 支付服务   │ 通知服务        │
│ - 注册登录 │ - 采购需求 │ - 需求发布 │ - 会员购买 │ - 站内消息      │
│ - 认证审核 │ - 工厂库存 │ - 临工报名 │ - 查看机会 │ - 微信推送      │
│ - 权限控制 │ - 代加工   │ - 打卡监管 │ - 工资结算 │                │
│           │ - 搜索筛选 │ - 工资发放 │ - 提现     │                │
└───────────┴───────────┴───────────┴───────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       数据层                                     │
├─────────────────────────────────┬───────────────────────────────┤
│           MySQL                 │           Redis               │
│  - 用户数据                      │  - 会话缓存                    │
│  - 业务数据                      │  - 查看机会计数                │
│  - 交易数据                      │  - 热点数据缓存                │
│  - 配置数据                      │  - 排行榜                     │
└─────────────────────────────────┴───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       外部服务                                   │
├───────────────┬───────────────┬─────────────────────────────────┤
│   微信开放平台  │   微信支付     │        云存储                   │
│   - 小程序登录  │   - 企业付款   │        - 图片存储               │
│   - 服务通知   │   - 用户提现   │                                │
└───────────────┴───────────────┴─────────────────────────────────┘
```

---

## 用户体系与权限总览

### 用户类型

| 用户类型 | 说明 | 认证要求 |
|---------|------|---------|
| 企业用户 | 工厂、贸易公司、电商等，类型仅为标签，权限相同 | 营业执照 + 法人身份证 + 联系人信息 |
| 临工用户 | 临时工人 | 身份证 + 手机号 + 姓名 |

### 权限矩阵

| 功能/页面 | 企业用户（未认证） | 企业用户（已认证） | 临工用户 |
|----------|------------------|------------------|---------|
| **采购需求** - 浏览列表 | ✅ | ✅ | ❌ 不可见 |
| **采购需求** - 查看联系方式 | ❌ | 🔒 消耗查看机会/会员免费 | ❌ |
| **采购需求** - 发布 | ❌ | ✅ | ❌ |
| **工厂库存** - 浏览列表 | ✅ | ✅ | ❌ 不可见 |
| **工厂库存** - 查看联系方式 | ❌ | 🔒 消耗查看机会/会员免费 | ❌ |
| **工厂库存** - 发布 | ❌ | ✅ | ❌ |
| **代加工服务** - 浏览列表 | ✅ | ✅ | ❌ 不可见 |
| **代加工服务** - 查看联系方式 | ❌ | 🔒 消耗查看机会/会员免费 | ❌ |
| **代加工服务** - 发布 | ❌ | ✅ | ❌ |
| **用工招聘** - 浏览列表 | ❌ 不需要 | ❌ 不需要 | ✅ 免费 |
| **用工招聘** - 查看联系方式 | ❌ | ❌ | ✅ 免费 |
| **用工招聘** - 发布 | ❌ | ✅ 免费发布 | ❌ |
| **用工招聘** - 报名应聘 | ❌ | ❌ | ✅ |

---

## 四大业务场景

### 场景一：外贸采购对接
```
贸易公司发布采购需求 ──→ 工厂浏览筛选 ──→ 查看联系方式（消耗机会）──→ 线下洽谈
```

### 场景二：工厂库存对接
```
工厂发布库存信息 ──→ 贸易公司/电商浏览 ──→ 查看联系方式（消耗机会）──→ 线下采购
```

### 场景三：代加工服务对接
```
需求方发布代加工需求 ──→ 有产能工厂浏览 ──→ 查看联系方式（消耗机会）──→ 线下合作
```

### 场景四：临时用工对接（核心闭环）
```
┌─────────────────────────────────────────────────────────────────────────┐
│                        临时用工业务闭环                                   │
└─────────────────────────────────────────────────────────────────────────┘

1. 发布需求
   工厂设定工资 25元/小时 ──→ 平台抽成20% ──→ 临工看到 20元/小时

2. 报名应聘
   临工浏览需求 ──→ 点击报名 ──→ 进入报名列表

3. 人员分配
   平台管理员查看报名列表 ──→ 指定临时管理员 ──→ 确定参与临工名单

4. 出勤确认
   开工前一天系统提醒 ──→ 临工点击"确认出勤" ──→ 未确认者释放名额

5. 开工监管
   临时管理员现场核验签到 ──→ 记录工时/计件 ──→ 上传现场照片

6. 收工结算
   临时管理员提交核验单 ──→ 三方确认（工厂、临工、平台）

7. 工资支付
   工厂按实际工时/计件支付到平台（微信支付）

8. 临工提现
   平台扣除抽成 ──→ 临工随时提现到微信零钱（免手续费）
```

---

## 数据流转图

### 信息流
```
                    ┌─────────────┐
                    │   发布信息   │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ 关键词检查   │ ←── 后台配置黑名单
                    └──────┬──────┘
                           │
              ┌────────────┴────────────┐
              │                         │
              ▼                         ▼
       ┌─────────────┐          ┌─────────────┐
       │  触发关键词  │          │  通过检查    │
       │  提示修改    │          └──────┬──────┘
       │  保留原文    │                 │
       └─────────────┘                 ▼
                              ┌─────────────────┐
                              │ 审核模式判断     │ ←── 后台开关
                              └────────┬────────┘
                                       │
                          ┌────────────┴────────────┐
                          │                         │
                          ▼                         ▼
                   ┌─────────────┐          ┌─────────────┐
                   │ 自动审核开启 │          │ 人工审核    │
                   │ 直接上架     │          │ 进入待审核  │
                   └─────────────┘          └─────────────┘
```

### 资金流（临工用工）
```
┌─────────┐    支付工资     ┌─────────┐    扣除抽成    ┌─────────┐
│  工厂   │ ─────────────→ │  平台   │ ─────────────→ │ 平台收入 │
└─────────┘                └────┬────┘                └─────────┘
                                │
                                │ 发放工资
                                ▼
                          ┌─────────┐    提现      ┌─────────────┐
                          │ 临工余额 │ ──────────→ │ 微信零钱     │
                          └─────────┘             └─────────────┘
```

### 资金流（会员/查看机会）
```
┌─────────┐    购买会员/查看机会    ┌─────────┐
│ 企业用户 │ ────────────────────→ │  平台   │
└─────────┘                        └─────────┘
```

---

## 模块清单

| 模块 | 文档 | 说明 |
|-----|------|------|
| 用户体系 | 01-用户体系模块.md | 用户类型、认证、权限、登录 |
| 供需信息 | 02-供需信息模块.md | 采购/库存/代加工的发布、查看、筛选 |
| 临工用工 | 03-临工用工模块.md | 用工发布、报名、监管、打卡、结算 |
| 支付财务 | 04-支付与财务模块.md | 会员、查看机会、工资支付、提现 |
| 消息通知 | 05-消息与通知模块.md | 站内消息、微信服务通知 |
| 管理后台 | 06-管理后台模块.md | 后台功能、所有可配置项汇总 |
| 数据库 | 07-数据库设计.md | 完整表结构 |
| API接口 | 08-API接口设计.md | 接口规范 |

---

## 开发分工建议

### 两人全栈分工方案

**开发者A：用户体系 + 供需信息 + 管理后台基础**
- 用户注册/登录
- 企业认证/临工认证
- 采购需求、库存、代加工的发布与查看
- 搜索筛选功能
- 后台用户管理、信息审核

**开发者B：临工用工 + 支付财务 + 消息通知**
- 用工需求发布
- 临工报名、人员分配
- 临时管理员监管功能
- 打卡、工时/计件记录
- 微信支付对接（会员、工资、提现）
- 消息通知系统

### Git 协作方案

```
main (生产分支)
  └── develop (开发主分支)
        ├── feature/user-system (开发者A)
        ├── feature/supply-demand (开发者A)
        ├── feature/labor-system (开发者B)
        ├── feature/payment (开发者B)
        └── ...
```

**工作流程：**
1. 先共同搭建项目框架（目录结构、基础配置、数据库连接、公共组件）
2. 各自从 `develop` 拉取 `feature/xxx` 分支
3. 完成后提 PR 合并到 `develop`
4. 定期同步 `develop` 到自己分支

---

## 重要设计原则

### 1. 所有数值后台可配置
**绝对不要在代码中写死任何数值**，包括但不限于：
- 价格（会员价格、查看机会价格、广告位价格、置顶价格）
- 次数（新用户初始查看机会、有效期天数）
- 比例（平台抽成比例、管理员服务费分成比例、超额报名比例）
- 列表（开放城市、工种列表、关键词黑名单）

### 2. 用户类型隔离
- 企业用户和临工用户看到的页面、搜索范围完全不同
- 这是防止商业模式漏洞的核心设计

### 3. 信息与联系方式分离
- 信息本身（标题、描述、图片）免费浏览
- 联系方式需要消耗查看机会或会员权益
- 临工查看用工信息完全免费（包括联系方式）

---

## 待确认事项

| 事项 | 状态 | 说明 |
|-----|------|------|
| 分销拉新功能 | ⏳ 待确认 | 需与甲方确认是否纳入第一版 |
| 工厂不付款保障机制 | ⏳ 待定 | 押金制/信用制，后续确定 |
