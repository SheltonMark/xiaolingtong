<!--pages/job-detail/job-detail.wxml-->
<view class="jd-page {{(userRole === 'worker' || (userRole === 'enterprise' && job.status === 'pending_settlement')) ? 'jd-page-with-apply' : ''}}">
  <!-- 现场图片 -->
  <view style="position:relative;" wx:if="{{job.images && job.images.length > 0}}">
    <swiper class="jd-swiper"
            indicator-dots autoplay circular bindchange="onSwiperChange">
      <swiper-item wx:for="{{job.images}}" wx:key="*this">
        <image src="{{item}}" mode="aspectFill" class="jd-swiper-img" />
      </swiper-item>
    </swiper>
    <view class="swiper-counter">{{swiperCurrent + 1}}/{{job.images.length}}</view>
  </view>

  <!-- 核心信息 -->
  <view class="salary-section">
    <view class="salary-row">
      <text class="salary-big text-cta">{{job.salary}}</text>
      <text class="salary-unit text-cta">{{job.salaryUnit}}</text>
      <text class="urgent-badge" wx:if="{{job.urgent}}">急招</text>
    </view>
    <text class="jd-title">{{job.title}} · 需{{job.need}}人</text>
    <view class="location-row">
      <text class="loc-icon iconfont icon-address"></text>
      <text class="loc-text">{{job.location}} · 距您{{job.distance}}</text>
    </view>
  </view>

  <!-- 工作详情 -->
  <view class="detail-card">
    <view class="card-header-row">
      <text class="card-icon iconfont icon-xiangqing"></text>
      <text class="card-label">工作详情</text>
    </view>
    <view class="detail-list">
      <view class="detail-row">
        <text class="dl">工种</text><text class="dv">{{job.title}}</text>
      </view>
      <view class="detail-row">
        <text class="dl">结算方式</text><text class="dv">{{job.salaryType}}</text>
      </view>
      <view class="detail-row">
        <text class="dl">工作日期</text><text class="dv">{{job.dateRange}}</text>
      </view>
      <view class="detail-row">
        <text class="dl">工作时间</text><text class="dv">{{job.hours}}</text>
      </view>
      <view class="detail-row">
        <text class="dl">工作内容</text><text class="dv">{{job.description}}</text>
      </view>
      <view class="detail-row">
        <text class="dl">报名人数</text>
        <text class="dv"><text class="text-cta font-semibold">{{job.applied}}</text> / {{job.total}}人</text>
      </view>
    </view>
  </view>

  <!-- 福利标签 -->
  <view class="detail-card">
    <text class="card-label">福利待遇</text>
    <view class="tags-wrap">
      <text class="benefit-tag benefit-{{item.color || 'green'}}" wx:for="{{job.benefits}}" wx:key="label">{{item.label}}</text>
    </view>
  </view>

  <!-- 招工企业 -->
  <view class="detail-card">
    <view class="card-header-row">
      <text class="card-icon iconfont icon-gongsi"></text>
      <text class="card-label">招工企业</text>
    </view>
    <view class="company-row">
      <view class="text-avatar" style="width:80rpx;height:80rpx;font-size:28rpx;background-color:#10B981;">{{job.company.name[0]}}</view>
      <view class="comp-info">
        <view class="comp-name-row">
          <text class="comp-name">{{job.company.name}}</text>
          <text class="cert-badge" wx:if="{{job.company.verified}}">已认证</text>
        </view>
        <text class="comp-credit">信用分 <text class="text-cta font-semibold">{{job.company.creditScore}}</text> · {{job.location}}</text>
      </view>
    </view>
    <view class="contact-list">
      <view class="contact-row">
        <text class="contact-label">联系人</text>
        <text class="contact-value">{{job.company.contact}}</text>
      </view>
      <view class="contact-row">
        <text class="contact-label">联系电话</text>
        <text class="contact-value text-primary font-medium" bindtap="onCallPhone">{{job.company.phone}}</text>
      </view>
    </view>
  </view>

  <!-- 底部报名（仅临工可见） -->
  <view class="apply-wrap" wx:if="{{userRole === 'worker'}}">
    <button class="btn btn-cta apply-btn" bindtap="onApply">
      <text class="iconfont icon-baoming"></text>
      <text>立即报名</text>
    </button>
    <text class="apply-hint">报名后等待平台分配，开工前一天需确认出勤</text>
  </view>

  <!-- 底部结算（企业用户 + 待结算状态） -->
  <view class="apply-wrap" wx:if="{{userRole === 'enterprise' && job.status === 'pending_settlement'}}">
    <button class="btn btn-cta apply-btn" bindtap="onGoSettlement">去结算支付</button>
    <text class="apply-hint">收工已完成，请尽快完成工资结算</text>
  </view>
</view>
