<!--pages/settlement/settlement.wxml-->
<view class="st-page">
  <!-- 工作概要 -->
  <view class="st-card">
    <view class="st-job-header">
      <image class="st-avatar-img" src="https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=60&h=60&fit=crop" mode="aspectFill" />
      <view class="st-job-info">
        <text class="st-company">{{job.company}} · {{job.jobType}}</text>
        <text class="st-date">{{job.dateRange}}</text>
      </view>
    </view>
    <view class="st-summary">
      <view class="st-sum-item">
        <text class="st-sum-val text-primary">{{job.totalWorkers}}</text>
        <text class="st-sum-label">实到人数</text>
      </view>
      <view class="st-sum-item">
        <text class="st-sum-val text-cta">{{job.totalHours}}</text>
        <text class="st-sum-label">总工时(h)</text>
      </view>
      <view class="st-sum-item">
        <text class="st-sum-val text-warm">¥{{job.factoryTotal}}</text>
        <text class="st-sum-label">工厂总支付</text>
      </view>
    </view>
  </view>

  <!-- 确认状态 -->
  <view class="st-card">
    <text class="card-title">确认状态</text>
    <view class="step-list">
      <view class="step-item" wx:for="{{steps}}" wx:key="label">
        <view class="step-dot {{item.done ? 'dot-done' : 'dot-pending'}}">
          <text wx:if="{{item.done}}">✓</text>
          <text wx:else>⏱</text>
        </view>
        <view class="step-content">
          <text class="step-label">{{item.label}}</text>
          <text class="step-time">{{item.time}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 结算明细 -->
  <view class="st-card">
    <text class="card-title">结算明细</text>
    <!-- 表头 -->
    <view class="table-header">
      <text class="th" style="flex:1.2;">姓名</text>
      <text class="th" style="flex:1;">工时</text>
      <text class="th" style="flex:1.2;">工厂付</text>
      <text class="th" style="flex:1.2;">临工得</text>
      <text class="th" style="flex:1;">状态</text>
    </view>
    <!-- 表行 -->
    <view class="table-row" wx:for="{{workers}}" wx:key="name">
      <text class="td" style="flex:1.2;">{{item.name}}</text>
      <text class="td" style="flex:1;">{{item.hours}}h</text>
      <text class="td" style="flex:1.2;">¥{{item.factoryPay}}</text>
      <text class="td" style="flex:1.2;">¥{{item.workerPay}}</text>
      <text class="td {{item.confirmed ? 'text-fresh' : 'text-warm'}}" style="flex:1;">{{item.confirmed ? '已确认' : '待确认'}}</text>
    </view>
    <text class="view-all" bindtap="onViewAll">查看全部{{job.totalWorkers}}人明细</text>
  </view>

  <!-- 费用汇总 -->
  <view class="st-card">
    <text class="card-title">费用汇总</text>
    <view class="fee-list">
      <view class="fee-row">
        <text class="fee-label">工厂总支付</text>
        <text class="fee-value">¥{{fees.factoryTotal}}</text>
      </view>
      <view class="fee-row">
        <text class="fee-label">平台服务费（20%）</text>
        <text class="fee-value fee-minus">-¥{{fees.platformFee}}</text>
      </view>
      <view class="fee-row">
        <text class="fee-label">管理员服务费</text>
        <text class="fee-value fee-minus">-¥{{fees.managerFee}}</text>
      </view>
      <view class="fee-divider"></view>
      <view class="fee-row fee-total">
        <text class="fee-label">临工实发总额</text>
        <text class="fee-value text-cta">¥{{fees.workerTotal}}</text>
      </view>
    </view>
  </view>

  <!-- 底部支付 -->
  <view class="st-bottom">
    <button class="btn btn-primary" bindtap="onPay">确认支付 ¥{{job.factoryTotal}}</button>
    <text class="st-hint">支付后工资将自动发放至临工钱包</text>
  </view>
</view>
