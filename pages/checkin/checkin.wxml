<!--pages/checkin/checkin.wxml-->
<view class="ci-page">
  <!-- å·¥å•ä¿¡æ¯å¡ç‰‡ -->
  <view class="ci-card">
    <view class="ci-job-header">
      <view class="text-avatar" style="width:60rpx;height:60rpx;font-size:24rpx;background-color:#10B981;">{{jobInfo.avatarText}}</view>
      <view class="ci-job-info">
        <text class="ci-company">{{jobInfo.company}} Â· ç”µå­ç»„è£…å·¥</text>
        <text class="ci-date">{{jobInfo.date}} Â· {{jobInfo.time}}</text>
      </view>
      <text class="admin-badge">ä¸´æ—¶ç®¡ç†å‘˜</text>
    </view>
    <view class="ci-stats">
      <view class="ci-stat">
        <text class="ci-stat-val text-primary">{{jobInfo.total}}</text>
        <text class="ci-stat-label">åº”åˆ°äººæ•°</text>
      </view>
      <view class="ci-stat">
        <text class="ci-stat-val text-fresh">{{jobInfo.checkedIn}}</text>
        <text class="ci-stat-label">å·²ç­¾åˆ°</text>
      </view>
      <view class="ci-stat">
        <text class="ci-stat-val text-rose">{{jobInfo.notCheckedIn}}</text>
        <text class="ci-stat-label">æœªç­¾åˆ°</text>
      </view>
    </view>
  </view>

  <!-- GPSå®šä½ç­¾åˆ° -->
  <view class="ci-card gps-card">
    <view class="gps-map">
      <view class="gps-ring-outer">
        <view class="gps-ring-inner">
          <text class="gps-pin iconfont icon-address"></text>
        </view>
      </view>
      <view class="gps-factory-label">{{jobInfo.company}}</view>
      <view class="gps-my-label">
        <text class="my-loc-icon">â—</text>
        <text>æˆ‘çš„ä½ç½®</text>
      </view>
    </view>
    <view class="gps-info">
      <view class="gps-icon-wrap">
        <text class="gps-icon-big iconfont icon-address"></text>
      </view>
      <text class="gps-factory">{{jobInfo.company}}</text>
      <text class="gps-hint">å½“å‰ä½ç½®è·ç¦»ç­¾åˆ°ç‚¹ <text class="text-fresh font-medium">{{distance}}m</text></text>
      <button class="btn btn-fresh checkin-btn" bindtap="onCheckin">ç«‹å³ç­¾åˆ°</button>
      <text class="refresh-link" bindtap="onRefreshLocation"><text class="iconfont icon-shuaxin"></text> åˆ·æ–°ä½ç½®</text>
      <text class="gps-range">éœ€åœ¨å·¥å‚{{maxDistance}}ç±³èŒƒå›´å†…ç­¾åˆ°</text>
    </view>
  </view>

  <!-- ç­¾åˆ°åå• -->
  <view class="ci-section">
    <view class="section-header">
      <text class="section-title">ç­¾åˆ°åå•</text>
      <text class="section-action" bindtap="onCheckAll">å…¨éƒ¨ç­¾åˆ°</text>
    </view>
    <view class="checkin-list">
      <view class="checkin-item" wx:for="{{workers}}" wx:key="id">
        <view class="text-avatar" style="width:64rpx;height:64rpx;font-size:26rpx;background-color:#3B82F6;">{{item.name[0]}}</view>
        <view class="checkin-info">
          <text class="checkin-name">{{item.name}}</text>
          <text class="checkin-time {{item.status === 'absent' ? 'text-rose' : ''}}">{{item.status === 'absent' ? 'æœªç­¾åˆ°' : item.time + ' ç­¾åˆ°' + (item.status === 'late' ? 'ï¼ˆè¿Ÿåˆ°ï¼‰' : '')}}</text>
        </view>
        <view wx:if="{{item.status === 'ontime'}}" class="check-circle check-green">
          <text class="check-mark">âœ“</text>
        </view>
        <view wx:elif="{{item.status === 'late'}}" class="check-circle check-amber">
          <text class="check-mark">âœ“</text>
        </view>
        <button wx:elif="{{item.status === 'absent'}}" class="manual-checkin-btn"
                data-id="{{item.id}}" bindtap="onManualCheckin">æ‰‹åŠ¨ç­¾åˆ°</button>
      </view>
    </view>
  </view>

  <!-- ä¸Šä¼ ç°åœºç…§ç‰‡ -->
  <view class="ci-card">
    <text class="card-title">ä¸Šä¼ ç°åœºç…§ç‰‡</text>
    <text class="photo-hint">è¯·æ‹æ‘„å·¥ä½œç°åœºç…§ç‰‡ä½œä¸ºç­¾åˆ°å‡­è¯</text>
    <view class="photo-grid">
      <view class="photo-add" bindtap="onTakePhoto">
        <text class="photo-add-icon">ğŸ“·</text>
        <text class="photo-add-text">æ‹ç…§</text>
      </view>
      <view class="photo-item" wx:for="{{photos}}" wx:key="*this">
        <image src="{{item}}" mode="aspectFill" class="photo-img" />
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨ -->
  <view class="ci-bottom">
    <button class="btn btn-fresh" bindtap="onConfirmStart">ç¡®è®¤å¼€å·¥</button>
  </view>
</view>
