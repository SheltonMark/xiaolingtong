<!--pages/work-session/work-session.wxml-->
<view class="ws-page">
  <!-- 计时模式 -->
  <block wx:if="{{mode === 'hourly'}}">
    <view class="status-card">
      <view class="sc-top">
        <text class="sc-company">{{status.company}} · {{status.jobType}}</text>
        <text class="sc-badge">进行中</text>
      </view>
      <view class="sc-hours">
        <text class="sc-hours-big">{{status.hoursToday}}</text>
        <text class="sc-hours-unit">小时</text>
      </view>
      <text class="sc-sub">今日已工作时长 · {{status.startTime}} 开始</text>
      <view class="sc-stats">
        <view class="sc-stat">
          <text class="sc-stat-val">出勤：{{status.todayAttend}}人</text>
        </view>
        <view class="sc-stat">
          <text class="sc-stat-val">异常：{{status.todayAnomaly}}人</text>
        </view>
        <view class="sc-stat">
          <text class="sc-stat-val">预计收工：{{status.estimateEnd}}</text>
        </view>
      </view>
    </view>

    <!-- 现场拍照 -->
    <view class="ws-card">
      <view class="card-header-row">
        <text class="card-title"><text class="iconfont icon-xiangji"></text> 现场拍照（每2小时）</text>
      </view>
      <view class="photo-list">
        <view class="photo-item photo-done" wx:for="{{photoRecords}}" wx:key="id" wx:if="{{item.status === 'done'}}">
          <view class="photo-thumb-placeholder photo-thumb-done">
            <text class="iconfont icon-tupian"></text>
          </view>
          <view class="photo-info">
            <text class="photo-time">{{item.timeRange}}</text>
            <text class="photo-status text-fresh">已上传 · {{item.uploadTime}}</text>
          </view>
          <text class="photo-check iconfont icon-yigouxuan text-fresh"></text>
        </view>
        <view class="photo-item photo-pending" wx:for="{{photoRecords}}" wx:key="id" wx:if="{{item.status === 'pending'}}">
          <view class="photo-thumb-placeholder">
            <text class="iconfont icon-xiangji"></text>
          </view>
          <view class="photo-info">
            <text class="photo-time">{{item.timeRange}}</text>
            <text class="photo-status text-warm">待上传</text>
          </view>
          <button class="photo-btn" data-id="{{item.id}}" bindtap="onTakePhoto">拍照</button>
        </view>
      </view>
    </view>
  </block>

  <!-- 计件模式 -->
  <block wx:if="{{mode === 'piece'}}">
    <view class="status-card status-card-piece">
      <view class="sc-top">
        <text class="sc-company">{{pieceStatus.company}} · {{pieceStatus.jobType}}</text>
        <text class="sc-badge">进行中</text>
      </view>
      <view class="sc-hours">
        <text class="sc-hours-big">{{pieceStatus.piecesToday}}</text>
        <text class="sc-hours-unit">件</text>
      </view>
      <text class="sc-sub">今日完成 · {{pieceStatus.pricePerPiece}}元/件 · 预计收入 ¥{{pieceStatus.earningsToday}}</text>
      <view class="sc-stats">
        <view class="sc-stat">
          <text class="sc-stat-val">出勤：{{pieceStatus.todayAttend}}人</text>
        </view>
        <view class="sc-stat">
          <text class="sc-stat-val">异常：{{pieceStatus.todayAnomaly}}人</text>
        </view>
      </view>
    </view>

    <!-- 计件录入 -->
    <view class="ws-card">
      <view class="card-header-row">
        <text class="card-title"><text class="iconfont icon-jilu"></text> 今日计件录入</text>
      </view>
      <view class="piece-list">
        <view class="piece-item" wx:for="{{workers}}" wx:key="id">
          <view class="piece-worker">
            <view class="text-avatar text-avatar-sm" style="background-color: #3B82F6;">{{item.name[0]}}</view>
            <view class="piece-info">
              <text class="piece-name">{{item.name}}</text>
              <text class="piece-sub">今日 {{item.todayPieces}}件 · 累计 {{item.totalPieces}}件</text>
            </view>
          </view>
          <input class="piece-input" type="number" placeholder="录入" data-id="{{item.id}}" bindinput="onPieceInput" value="{{item.inputValue}}" />
        </view>
      </view>
      <button class="piece-submit-btn" bindtap="onSubmitPieces">提交今日计件</button>
    </view>
  </block>

  <!-- 异常记录（共用） -->
  <view class="ws-card">
    <view class="card-header-row">
      <text class="card-title"><text class="iconfont icon-tishixinxi"></text> 异常记录</text>
    </view>
    <view class="anomaly-list" wx:if="{{anomalies.length > 0}}">
      <view class="anomaly-item" wx:for="{{anomalies}}" wx:key="id">
        <view class="anomaly-top">
          <text class="anomaly-name">{{item.name}} · {{item.type}}</text>
          <text class="anomaly-time">{{item.time}}</text>
        </view>
        <text class="anomaly-desc">{{item.desc}}</text>
      </view>
    </view>
    <button class="record-anomaly-btn" bindtap="onRecordAnomaly">
      <text>+ 记录异常</text>
    </button>
  </view>

  <!-- 底部 -->
  <view class="ws-bottom">
    <button class="btn btn-rose" bindtap="onFinishWork">确认收工</button>
    <text class="ws-hint">收工后将生成结算单，请确保所有记录准确</text>
  </view>
</view>
