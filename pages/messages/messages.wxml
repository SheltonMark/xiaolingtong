<!--pages/messages/messages.wxml-->
<view class="msg-page">
  <!-- 顶部 -->
  <view class="msg-header">
    <text class="msg-header-title">消息</text>
    <text class="msg-read-all" bindtap="onReadAll">全部已读</text>
  </view>

  <!-- Tab筛选：业务消息（左）+ 系统通知（右），带未读badge -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 0 ? 'tab-active' : ''}}" data-index="{{0}}" bindtap="onTabChange">
      <view class="tab-text-wrap">
        <text>业务消息</text>
        <view class="tab-badge" wx:if="{{chatUnreadCount > 0}}">{{chatUnreadCount}}</view>
      </view>
    </view>
    <view class="tab-item {{currentTab === 1 ? 'tab-active' : ''}}" data-index="{{1}}" bindtap="onTabChange">
      <view class="tab-text-wrap">
        <text>系统通知</text>
        <view class="tab-badge" wx:if="{{systemUnreadCount > 0}}">{{systemUnreadCount}}</view>
      </view>
    </view>
  </view>

  <!-- 业务消息（聊天列表） -->
  <view class="msg-list" wx:if="{{currentTab === 0}}">
    <view class="msg-card chat-card" wx:for="{{chatMessages}}" wx:key="id" bindtap="onTapChat" data-item="{{item}}">
      <view class="chat-avatar-wrap">
        <image class="chat-avatar-img" src="{{item.avatar}}" mode="aspectFill" />
        <view class="chat-badge" wx:if="{{item.unreadCount > 0}}">{{item.unreadCount}}</view>
      </view>
      <view class="msg-body">
        <view class="msg-top-row">
          <text class="msg-title">{{item.name}}</text>
          <text class="msg-time">{{item.time}}</text>
        </view>
        <text class="msg-desc">{{item.lastMsg}}</text>
      </view>
    </view>
  </view>

  <!-- 系统通知 -->
  <view class="msg-list" wx:if="{{currentTab === 1}}">
    <view class="msg-card {{item.unread ? 'msg-unread' : ''}}" style="{{item.unread ? 'border-left: 6rpx solid ' + item.borderColor + ';' : ''}}"
          wx:for="{{systemMessages}}" wx:key="id" bindtap="onTapMsg" data-item="{{item}}">
      <view class="msg-icon-wrap" style="background-color: {{item.iconBg}};">
        <text class="msg-icon-text">{{item.icon}}</text>
      </view>
      <view class="msg-body">
        <view class="msg-top-row">
          <text class="msg-title {{item.unread ? '' : 'msg-title-read'}}">{{item.title}}</text>
          <view class="msg-time-wrap">
            <view class="unread-dot" wx:if="{{item.unread}}"></view>
            <text class="msg-time">{{item.time}}</text>
          </view>
        </view>
        <text class="msg-desc {{item.unread ? '' : 'msg-desc-read'}}">{{item.desc}}</text>
      </view>
    </view>
  </view>
</view>
