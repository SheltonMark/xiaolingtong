<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- é¡¶éƒ¨æ  -->
  <view class="top-bar" style="padding-top: {{statusBarHeight}}px;">
    <view class="top-bar-inner">
      <!-- åŸå¸‚é€‰æ‹© -->
      <view class="city-selector">
        <text class="city-icon text-primary">ğŸ“</text>
        <text class="city-name">ä¸œè</text>
        <text class="city-arrow">â–¾</text>
      </view>
      <!-- æœç´¢æ¡† -->
      <view class="search-bar" bindtap="onSearch">
        <text class="search-icon">ğŸ”</text>
        <text class="search-placeholder">{{userRole === 'enterprise' ? 'æœç´¢äº§å“/å·¥è‰º/å·¥å‚' : 'æœç´¢å·¥ç§/åœ°åŒº'}}</text>
      </view>
      <!-- é€šçŸ¥ -->
      <view class="notify-btn" bindtap="onNotification">
        <text class="notify-icon">ğŸ””</text>
        <view class="notify-badge">3</view>
      </view>
    </view>

    <!-- ä¼ä¸šç«¯ Tab -->
    <view class="tab-bar" wx:if="{{userRole === 'enterprise'}}">
      <view class="tab-item {{currentTab === index ? 'tab-active' : ''}}"
            wx:for="{{tabs}}" wx:key="index"
            data-index="{{index}}" bindtap="onTabChange">
        <text class="tab-text">{{item}}</text>
        <view class="tab-line" wx:if="{{currentTab === index}}"></view>
      </view>
    </view>

    <!-- ä¸´å·¥ç«¯ç­›é€‰ -->
    <view class="filter-bar" wx:if="{{userRole === 'worker'}}">
      <view class="filter-item" wx:for="{{filterLabels}}" wx:key="index">
        <text class="filter-text">{{item}}</text>
        <text class="filter-arrow">â–¾</text>
      </view>
    </view>
  </view>

  <!-- ===== ä¼ä¸šç«¯å†…å®¹ ===== -->
  <view wx:if="{{userRole === 'enterprise'}}">
    <!-- å¹¿å‘Š Banner -->
    <view class="banner-wrap">
      <view class="banner-placeholder">
        <text class="banner-text">ğŸ“¢ å¹¿å‘Šä½æ‹›å•†ä¸­</text>
      </view>
    </view>

    <!-- Tab 0: é‡‡è´­éœ€æ±‚ -->
    <view wx:if="{{currentTab === 0}}">
      <!-- åˆ†ç±»å›¾æ ‡ -->
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{catePurchase}}" wx:key="label">
            <view class="cate-icon" style="background-color: {{item.bg}};">
              <text>{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">æœ€æ–°é‡‡è´­éœ€æ±‚</text>
          <text class="section-more text-primary">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <info-card wx:for="{{purchaseList}}" wx:key="id"
                   item="{{item}}"
                   bind:tap="onCardTap"
                   bind:wechat="onWechat"
                   bind:phone="onPhone" />
        <empty-state wx:if="{{purchaseList.length === 0}}" text="æš‚æ— é‡‡è´­éœ€æ±‚" />
      </view>
    </view>

    <!-- Tab 1: å·¥å‚åº“å­˜ -->
    <view wx:if="{{currentTab === 1}}">
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{cateStock}}" wx:key="label">
            <view class="cate-icon" style="background-color: {{item.bg}};">
              <text>{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">æœ€æ–°å·¥å‚åº“å­˜</text>
          <text class="section-more text-primary">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <info-card wx:for="{{stockList}}" wx:key="id"
                   item="{{item}}"
                   bind:tap="onCardTap"
                   bind:wechat="onWechat"
                   bind:phone="onPhone" />
        <empty-state wx:if="{{stockList.length === 0}}" text="æš‚æ— åº“å­˜ä¿¡æ¯" />
      </view>
    </view>

    <!-- Tab 2: ä»£åŠ å·¥ -->
    <view wx:if="{{currentTab === 2}}">
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{cateProcess}}" wx:key="label">
            <view class="cate-icon" style="background-color: {{item.bg}};">
              <text>{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">æœ€æ–°ä»£åŠ å·¥</text>
          <text class="section-more text-primary">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <info-card wx:for="{{processList}}" wx:key="id"
                   item="{{item}}"
                   bind:tap="onCardTap"
                   bind:wechat="onWechat"
                   bind:phone="onPhone" />
        <empty-state wx:if="{{!processList || processList.length === 0}}" text="æš‚æ— ä»£åŠ å·¥ä¿¡æ¯" />
      </view>
    </view>

    <!-- Tab 3: å‘å¸ƒæ‹›å·¥ -->
    <view wx:if="{{currentTab === 3}}">
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{cateJob}}" wx:key="label">
            <view class="cate-icon" style="background-color: {{item.bg}};">
              <text>{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">æœ€æ–°æ‹›å·¥ä¿¡æ¯</text>
          <text class="section-more text-primary">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <view class="job-card" wx:for="{{jobListEnterprise}}" wx:key="id"
              data-id="{{item.id}}" bindtap="onJobTap">
          <view class="job-header">
            <view class="job-header-left">
              <view class="job-avatar-placeholder">
                <text>ğŸ­</text>
              </view>
              <view class="job-company-info">
                <text class="job-company">{{item.companyName}}</text>
                <text class="job-meta">{{item.time}} Â· {{item.location}}</text>
              </view>
            </view>
            <view class="contact-btns">
              <view class="contact-btn btn-wechat" catchtap="onWechat">å¾®ä¿¡</view>
              <view class="contact-btn btn-phone" catchtap="onPhone">ç”µè¯</view>
            </view>
          </view>
          <text class="job-salary-line"><text class="text-cta font-semibold">{{item.salary}}</text> Â· {{item.title}} Â· <text class="text-rose" wx:if="{{item.urgent}}">æ€¥æ‹›</text></text>
          <text class="job-desc">{{item.desc}}</text>
          <view class="job-footer">
            <text class="job-applied">å·²æŠ¥å {{item.applied}}/{{item.total}}äºº</text>
            <view class="job-actions">
              <text class="job-action">åˆ†äº«</text>
              <text class="job-action">æŠ•è¯‰</text>
            </view>
          </view>
        </view>
        <empty-state wx:if="{{!jobListEnterprise || jobListEnterprise.length === 0}}" text="æš‚æ— æ‹›å·¥ä¿¡æ¯" />
      </view>
    </view>

    <!-- Tab 4: å·¥å‚åå½• -->
    <view wx:if="{{currentTab === 4}}">
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{cateFactory}}" wx:key="label">
            <view class="cate-icon" style="background-color: {{item.bg}};">
              <text>{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">å·¥å‚åå½•</text>
          <text class="section-more text-primary">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <view class="factory-card" wx:for="{{factoryList}}" wx:key="id">
          <view class="factory-top">
            <view class="factory-logo">ğŸ­</view>
            <view class="factory-info">
              <text class="factory-name">{{item.name}}</text>
              <text class="factory-sub">{{item.type}} Â· {{item.location}}</text>
            </view>
          </view>
          <view class="factory-tags">
            <text class="factory-tag tag-blue">å·²è®¤è¯</text>
            <text class="factory-tag" style="background-color:{{item.scaleBg}};color:{{item.scaleColor}};">{{item.scale}}</text>
            <text class="factory-years">å…¥é©»{{item.years}}å¹´</text>
          </view>
        </view>
        <empty-state wx:if="{{!factoryList || factoryList.length === 0}}" text="æš‚æ— å·¥å‚" />
      </view>
    </view>
  </view>

  <!-- ===== ä¸´å·¥ç«¯å†…å®¹ ===== -->
  <view wx:if="{{userRole === 'worker'}}" class="list-wrap">
    <view class="job-card" wx:for="{{jobList}}" wx:key="id"
          data-id="{{item.id}}" bindtap="onJobTap">
      <view class="job-header">
        <view class="job-header-left">
          <view class="job-avatar-placeholder">
            <text>ğŸ­</text>
          </view>
          <view class="job-company-info">
            <text class="job-company">{{item.companyName}}</text>
            <text class="job-meta">{{item.dateRange}} Â· {{item.location}} Â· {{item.distance}}</text>
          </view>
        </view>
        <view class="contact-btns">
          <view class="contact-btn btn-wechat" catchtap="onWechat">å¾®ä¿¡</view>
          <view class="contact-btn btn-phone" catchtap="onPhone">ç”µè¯</view>
        </view>
      </view>
      <text class="job-salary-line"><text class="text-cta font-semibold">{{item.salary}}{{item.salaryUnit}}</text> Â· {{item.title}} Â· <text class="{{item.tagColor}}">{{item.tagText}}</text></text>
      <text class="job-desc">éœ€è¦{{item.need}}äººï¼Œå·¥æœŸ{{item.dateRange}}ï¼Œ{{item.benefit}}</text>
      <view class="job-footer">
        <text class="job-applied">å·²æŠ¥å {{item.applied}}/{{item.need}}äºº</text>
        <view class="job-actions">
          <text class="job-action">åˆ†äº«</text>
          <text class="job-action">æŠ•è¯‰</text>
        </view>
      </view>
    </view>
    <empty-state wx:if="{{jobList.length === 0}}" text="æš‚æ— æ‹›å·¥ä¿¡æ¯" subText="é™„è¿‘æš‚æ—¶æ²¡æœ‰æ‹›å·¥éœ€æ±‚" />
  </view>
</view>
