<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- å›ºå®šé¡¶éƒ¨åŒºåŸŸï¼ˆæ•´ä½“ä¸€å—ï¼Œæ— ç¼éš™ï¼‰ -->
  <view class="fixed-header" style="padding-top: {{statusBarHeight}}px;">
    <!-- æ ‡é¢˜è¡Œï¼ˆä¸èƒ¶å›ŠåŒè¡Œï¼‰ -->
    <view class="nav-bar-inner" style="height: {{menuHeight}}px;">
      <text class="nav-title">{{userRole === 'enterprise' ? 'é¦–é¡µ' : 'ä¸´æ—¶å·¥'}}</text>
    </view>
    <!-- æœç´¢è¡Œ -->
    <view class="top-bar-inner">
      <view class="city-selector" bindlongpress="onSwitchRole">
        <text class="city-icon">ğŸ“</text>
        <text class="city-name">ä¸œè</text>
        <text class="city-arrow">â€º</text>
      </view>
      <view class="search-bar" bindtap="onSearch">
        <text class="search-icon">ğŸ”</text>
        <text class="search-placeholder">{{userRole === 'enterprise' ? 'æœç´¢äº§å“/å·¥è‰º/å·¥å‚' : 'æœç´¢å·¥ç§/åœ°åŒº'}}</text>
      </view>
      <view class="notify-btn" bindtap="onNotification">
        <text class="notify-icon">ğŸ””</text>
        <view class="notify-badge">3</view>
      </view>
    </view>
    <!-- ä¼ä¸šç«¯ Tab -->
    <view class="tab-bar-ent" wx:if="{{userRole === 'enterprise'}}">
      <view class="tab-item {{currentTab === index ? 'tab-active' : ''}}"
            wx:for="{{tabs}}" wx:key="index"
            data-index="{{index}}" bindtap="onTabChange">
        <text class="tab-text">{{item}}</text>
        <view class="tab-line" wx:if="{{currentTab === index}}"></view>
      </view>
    </view>
    <!-- ä¸´å·¥ç«¯ç­›é€‰ -->
    <view class="filter-bar" wx:if="{{userRole === 'worker'}}">
      <view class="filter-item" wx:for="{{filterLabels}}" wx:key="index">
        <text class="filter-text">{{item}}</text>
        <text class="filter-arrow">âŒ„</text>
      </view>
    </view>
  </view>

  <view class="content-spacer" style="height: {{headerHeight ? headerHeight + 'px' : (navBarHeight + (userRole === 'enterprise' ? 140 : 110)) + 'px'}};"></view>

  <!-- ===== ä¼ä¸šç«¯å†…å®¹ ===== -->
  <view wx:if="{{userRole === 'enterprise'}}">
    <!-- å¹¿å‘Š Banner -->
    <view class="banner-wrap">
      <view class="banner-inner">
        <image src="https://picsum.photos/700/280"
               class="banner-img" mode="aspectFill" />
      </view>
    </view>

    <!-- Tab 0: é‡‡è´­éœ€æ±‚ -->
    <view wx:if="{{currentTab === 0}}">
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{catePurchase}}" wx:key="label">
            <view class="cate-icon {{item.active ? 'cate-icon-active' : ''}}" style="background-color: {{item.active ? '#3B82F6' : item.bg}};">
              <text class="cate-icon-text {{item.active ? 'cate-icon-text-white' : ''}}" style="{{item.active ? '' : 'color:' + (item.iconColor || '#64748B')}}">{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">æœ€æ–°é‡‡è´­éœ€æ±‚</text>
          <text class="section-more">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <info-card wx:for="{{purchaseList}}" wx:key="id"
                   item="{{item}}"
                   bind:tap="onCardTap"
                   bind:wechat="onWechat"
                   bind:phone="onPhone"
                   bind:report="onReport" />
        <empty-state wx:if="{{purchaseList.length === 0}}" text="æš‚æ— é‡‡è´­éœ€æ±‚" />
      </view>
    </view>

    <!-- Tab 1: å·¥å‚åº“å­˜ -->
    <view wx:if="{{currentTab === 1}}">
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{cateStock}}" wx:key="label">
            <view class="cate-icon {{item.active ? 'cate-icon-active' : ''}}" style="background-color: {{item.active ? '#3B82F6' : item.bg}};">
              <text class="cate-icon-text {{item.active ? 'cate-icon-text-white' : ''}}" style="{{item.active ? '' : 'color:' + (item.iconColor || '#64748B')}}">{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">æœ€æ–°å·¥å‚åº“å­˜</text>
          <text class="section-more">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <info-card wx:for="{{stockList}}" wx:key="id"
                   item="{{item}}"
                   bind:tap="onCardTap"
                   bind:wechat="onWechat"
                   bind:phone="onPhone"
                   bind:report="onReport" />
        <empty-state wx:if="{{stockList.length === 0}}" text="æš‚æ— åº“å­˜ä¿¡æ¯" />
      </view>
    </view>

    <!-- Tab 2: ä»£åŠ å·¥ -->
    <view wx:if="{{currentTab === 2}}">
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{cateProcess}}" wx:key="label">
            <view class="cate-icon {{item.active ? 'cate-icon-active' : ''}}" style="background-color: {{item.active ? '#3B82F6' : item.bg}};">
              <text class="cate-icon-text {{item.active ? 'cate-icon-text-white' : ''}}" style="{{item.active ? '' : 'color:' + (item.iconColor || '#64748B')}}">{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">æœ€æ–°ä»£åŠ å·¥</text>
          <text class="section-more">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <info-card wx:for="{{processList}}" wx:key="id"
                   item="{{item}}"
                   bind:tap="onCardTap"
                   bind:wechat="onWechat"
                   bind:phone="onPhone"
                   bind:report="onReport" />
        <empty-state wx:if="{{!processList || processList.length === 0}}" text="æš‚æ— ä»£åŠ å·¥ä¿¡æ¯" />
      </view>
    </view>

    <!-- Tab 3: å‘å¸ƒæ‹›å·¥ -->
    <view wx:if="{{currentTab === 3}}">
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{cateJob}}" wx:key="label">
            <view class="cate-icon {{item.active ? 'cate-icon-active' : ''}}" style="background-color: {{item.active ? '#3B82F6' : item.bg}};">
              <text class="cate-icon-text {{item.active ? 'cate-icon-text-white' : ''}}" style="{{item.active ? '' : 'color:' + (item.iconColor || '#64748B')}}">{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">æœ€æ–°æ‹›å·¥ä¿¡æ¯</text>
          <text class="section-more">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <view class="job-card" wx:for="{{jobListEnterprise}}" wx:key="id"
              data-id="{{item.id}}" bindtap="onJobTap">
          <view class="job-header">
            <view class="job-header-left">
              <view class="text-avatar text-avatar-lg" style="background-color:#10B981;">{{item.companyName[0]}}</view>
              <view class="job-company-info">
                <text class="job-company">{{item.companyName}}</text>
                <text class="job-meta">{{item.time}} Â· {{item.location}}</text>
              </view>
            </view>
            <view class="contact-btns">
              <view class="contact-btn btn-wechat" catchtap="onWechat" data-id="{{item.id}}">å¾®ä¿¡</view>
              <view class="contact-btn btn-phone" catchtap="onPhone" data-id="{{item.id}}">ç”µè¯</view>
            </view>
          </view>
          <text class="job-salary-line"><text class="text-cta font-semibold">{{item.salary}}</text> Â· {{item.title}}<text wx:if="{{item.urgent}}" class="text-rose"> Â· æ€¥æ‹›</text></text>
          <text class="job-desc">{{item.desc}}</text>
          <view class="job-footer">
            <text class="job-applied">å·²æŠ¥å {{item.applied}}/{{item.total}}äºº</text>
            <view class="job-actions">
              <view class="job-action-item">
                <text class="action-icon">â†—</text>
                <text class="job-action">åˆ†äº«</text>
              </view>
              <view class="job-action-item" catchtap="onReport" data-id="{{item.id}}">
                <text class="action-icon">âš </text>
                <text class="job-action">æŠ•è¯‰</text>
              </view>
            </view>
          </view>
        </view>
        <empty-state wx:if="{{!jobListEnterprise || jobListEnterprise.length === 0}}" text="æš‚æ— æ‹›å·¥ä¿¡æ¯" />
      </view>
      <!-- æ‚¬æµ®å‘å¸ƒæ‹›å·¥æŒ‰é’® -->
      <view class="fab-publish" bindtap="onPublishJob">
        <text class="fab-publish-icon">+</text>
        <text class="fab-publish-text">å‘å¸ƒ</text>
      </view>
    </view>

    <!-- Tab 4: å·¥å‚åå½• -->
    <view wx:if="{{currentTab === 4}}">
      <view class="cate-grid-wrap">
        <view class="cate-grid">
          <view class="cate-item" wx:for="{{cateFactory}}" wx:key="label">
            <view class="cate-icon {{item.active ? 'cate-icon-active' : ''}}" style="background-color: {{item.active ? '#3B82F6' : item.bg}};">
              <text class="cate-icon-text {{item.active ? 'cate-icon-text-white' : ''}}" style="{{item.active ? '' : 'color:' + (item.iconColor || '#64748B')}}">{{item.icon}}</text>
            </view>
            <text class="cate-label {{item.active ? 'cate-label-active' : ''}}">{{item.label}}</text>
          </view>
        </view>
      </view>
      <view class="list-wrap">
        <view class="section-header">
          <text class="section-title">å·¥å‚åå½•</text>
          <text class="section-more">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <view class="factory-card" wx:for="{{factoryList}}" wx:key="id">
          <view class="factory-top">
            <image wx:if="{{item.image}}" src="{{item.image}}" class="factory-logo-img" mode="aspectFill" />
            <view wx:else class="factory-logo">ğŸ­</view>
            <view class="factory-info">
              <text class="factory-name">{{item.name}}</text>
              <text class="factory-sub">{{item.type}} Â· {{item.location}}</text>
            </view>
          </view>
          <view class="factory-tags">
            <text class="factory-tag tag-blue">å·²è®¤è¯</text>
            <text class="factory-tag" style="background-color:{{item.scaleBg}};color:{{item.scaleColor}};">{{item.scale}}</text>
            <text class="factory-years">å…¥é©»{{item.years}}å¹´</text>
          </view>
        </view>
        <empty-state wx:if="{{!factoryList || factoryList.length === 0}}" text="æš‚æ— å·¥å‚" />
      </view>
    </view>
  </view>

  <!-- ===== ä¸´å·¥ç«¯å†…å®¹ ===== -->
  <view wx:if="{{userRole === 'worker'}}" class="worker-list-wrap">
    <view class="job-card" wx:for="{{jobList}}" wx:key="id"
          data-id="{{item.id}}" bindtap="onJobTap">
      <view class="job-header">
        <view class="job-header-left">
          <view class="text-avatar text-avatar-lg" style="background-color:#10B981;">{{item.companyName[0]}}</view>
          <view class="job-company-info">
            <text class="job-company">{{item.companyName}}</text>
            <text class="job-meta">{{item.dateRange}} Â· {{item.location}} Â· {{item.distance}}</text>
          </view>
        </view>
        <view class="contact-btns">
          <view class="contact-btn btn-wechat" catchtap="onWechat" data-id="{{item.id}}">å¾®ä¿¡</view>
          <view class="contact-btn btn-phone" catchtap="onPhone" data-id="{{item.id}}">ç”µè¯</view>
        </view>
      </view>
      <text class="job-salary-line"><text class="text-cta font-semibold">{{item.salary}}{{item.salaryUnit}}</text> Â· {{item.title}}<text wx:if="{{item.tagText}}" class="{{item.tagColor}}"> Â· {{item.tagText}}</text></text>
      <text class="job-desc">{{item.desc}}</text>
      <!-- å›¾ç‰‡ç½‘æ ¼ -->
      <view class="job-images" wx:if="{{item.images && item.images.length > 0}}">
        <view class="job-img-wrap" wx:for="{{item.images}}" wx:for-item="img" wx:key="*this">
          <image src="{{img}}" mode="aspectFill" class="job-img" />
        </view>
      </view>
      <view class="job-footer">
        <text class="job-applied">å·²æŠ¥å {{item.applied}}/{{item.need}}äºº</text>
        <view class="job-actions">
          <view class="job-action-item">
            <text class="action-icon">â†—</text>
            <text class="job-action">åˆ†äº«</text>
          </view>
          <view class="job-action-item" catchtap="onReport" data-id="{{item.id}}">
            <text class="action-icon">âš </text>
            <text class="job-action">æŠ•è¯‰</text>
          </view>
        </view>
      </view>
    </view>
    <empty-state wx:if="{{jobList.length === 0}}" text="æš‚æ— æ‹›å·¥ä¿¡æ¯" subText="é™„è¿‘æš‚æ—¶æ²¡æœ‰æ‹›å·¥éœ€æ±‚" />
  </view>
</view>
