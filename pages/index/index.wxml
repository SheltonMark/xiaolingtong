<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- é¡¶éƒ¨æ  -->
  <view class="top-bar" style="padding-top: {{statusBarHeight}}px;">
    <view class="top-bar-inner">
      <!-- åŸå¸‚é€‰æ‹© -->
      <view class="city-selector">
        <text class="city-icon">ğŸ“</text>
        <text class="city-name">ä¸œè</text>
        <text class="city-arrow">â–¾</text>
      </view>
      <!-- æœç´¢æ¡† -->
      <view class="search-bar" bindtap="onSearch">
        <text class="search-icon">ğŸ”</text>
        <text class="search-placeholder">{{userRole === 'enterprise' ? 'æœç´¢äº§å“/å·¥è‰º/å·¥å‚' : 'æœç´¢å·¥ç§/åœ°åŒº'}}</text>
      </view>
      <!-- é€šçŸ¥ -->
      <view class="notify-btn" bindtap="onNotification">
        <text class="notify-icon">ğŸ””</text>
        <view class="notify-badge">3</view>
      </view>
    </view>

    <!-- ä¼ä¸šç«¯ Tab -->
    <view class="tab-bar" wx:if="{{userRole === 'enterprise'}}">
      <view class="tab-item {{currentTab === index ? 'tab-active' : ''}}"
            wx:for="{{tabs}}" wx:key="index"
            data-index="{{index}}" bindtap="onTabChange">
        <text class="tab-text">{{item}}</text>
        <view class="tab-line" wx:if="{{currentTab === index}}"></view>
      </view>
    </view>

    <!-- ä¸´å·¥ç«¯ç­›é€‰ -->
    <view class="filter-bar" wx:if="{{userRole === 'worker'}}">
      <view class="filter-item" wx:for="{{filterLabels}}" wx:key="index">
        <text class="filter-text">{{item}}</text>
        <text class="filter-arrow">â–¾</text>
      </view>
    </view>
  </view>

  <!-- ===== ä¼ä¸šç«¯å†…å®¹ ===== -->
  <view wx:if="{{userRole === 'enterprise'}}">
    <!-- å¹¿å‘Š Banner -->
    <view class="banner-wrap">
      <view class="banner-placeholder">
        <text class="banner-text">ğŸ“¢ å¹¿å‘Šä½æ‹›å•†ä¸­</text>
      </view>
    </view>

    <!-- Tab 0: é‡‡è´­éœ€æ±‚ -->
    <view wx:if="{{currentTab === 0}}" class="list-wrap">
      <view class="section-header">
        <text class="section-title">æœ€æ–°é‡‡è´­éœ€æ±‚</text>
        <text class="section-more text-primary">æŸ¥çœ‹æ›´å¤š</text>
      </view>
      <info-card wx:for="{{purchaseList}}" wx:key="id"
                 item="{{item}}"
                 bind:tap="onCardTap"
                 bind:wechat="onWechat"
                 bind:phone="onPhone" />
      <empty-state wx:if="{{purchaseList.length === 0}}" text="æš‚æ— é‡‡è´­éœ€æ±‚" />
    </view>

    <!-- Tab 1: å·¥å‚åº“å­˜ -->
    <view wx:if="{{currentTab === 1}}" class="list-wrap">
      <view class="section-header">
        <text class="section-title">æœ€æ–°å·¥å‚åº“å­˜</text>
        <text class="section-more text-primary">æŸ¥çœ‹æ›´å¤š</text>
      </view>
      <info-card wx:for="{{stockList}}" wx:key="id"
                 item="{{item}}"
                 bind:tap="onCardTap"
                 bind:wechat="onWechat"
                 bind:phone="onPhone" />
      <empty-state wx:if="{{stockList.length === 0}}" text="æš‚æ— åº“å­˜ä¿¡æ¯" />
    </view>

    <!-- Tab 2: ä»£åŠ å·¥ -->
    <view wx:if="{{currentTab === 2}}" class="list-wrap">
      <empty-state text="æš‚æ— ä»£åŠ å·¥ä¿¡æ¯" subText="æ•¬è¯·æœŸå¾…" />
    </view>

    <!-- Tab 3: æ‹›å·¥ä¿¡æ¯ -->
    <view wx:if="{{currentTab === 3}}" class="list-wrap">
      <view class="section-header">
        <text class="section-title">æœ€æ–°æ‹›å·¥ä¿¡æ¯</text>
        <text class="section-more text-primary">æŸ¥çœ‹æ›´å¤š</text>
      </view>
      <view class="job-card" wx:for="{{jobListEnterprise}}" wx:key="id"
            data-id="{{item.id}}" bindtap="onJobTap">
        <view class="job-header">
          <view class="job-header-left">
            <view class="job-avatar-placeholder">
              <text>ğŸ­</text>
            </view>
            <view class="job-company-info">
              <text class="job-company">{{item.companyName}}</text>
              <text class="job-meta">{{item.time}} Â· {{item.location}}</text>
            </view>
          </view>
          <view class="contact-btns">
            <view class="contact-btn btn-wechat" catchtap="onWechat">å¾®ä¿¡</view>
            <view class="contact-btn btn-phone" catchtap="onPhone">ç”µè¯</view>
          </view>
        </view>
        <view class="job-title-row">
          <text class="job-title">{{item.title}}</text>
          <text class="job-salary text-cta">{{item.salary}}</text>
        </view>
        <view class="job-tags">
          <text class="job-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
        </view>
        <view class="job-footer">
          <text class="job-applied">å·²æŠ¥å {{item.applied}}/{{item.total}}äºº</text>
        </view>
      </view>
      <empty-state wx:if="{{!jobListEnterprise || jobListEnterprise.length === 0}}" text="æš‚æ— æ‹›å·¥ä¿¡æ¯" />
    </view>
  </view>

  <!-- ===== ä¸´å·¥ç«¯å†…å®¹ ===== -->
  <view wx:if="{{userRole === 'worker'}}" class="list-wrap">
    <view class="job-card" wx:for="{{jobList}}" wx:key="id"
          data-id="{{item.id}}" bindtap="onJobTap">
      <view class="job-header">
        <view class="job-header-left">
          <view class="job-avatar-placeholder">
            <text>ğŸ­</text>
          </view>
          <view class="job-company-info">
            <text class="job-company">{{item.companyName}}</text>
            <text class="job-meta">{{item.dateRange}} Â· {{item.location}} Â· {{item.distance}}</text>
          </view>
        </view>
        <view class="contact-btns">
          <view class="contact-btn btn-wechat" catchtap="onWechat">å¾®ä¿¡</view>
          <view class="contact-btn btn-phone" catchtap="onPhone">ç”µè¯</view>
        </view>
      </view>
      <view class="job-title-row">
        <text class="job-salary-big text-cta">{{item.salary}}<text class="job-salary-unit">{{item.salaryUnit}}</text></text>
        <text class="job-type-label">{{item.title}}</text>
      </view>
      <text class="job-desc">éœ€è¦{{item.need}}äººï¼Œå·¥æœŸ{{item.dateRange}}ï¼ŒåŒ…åˆé¤</text>
      <view class="job-tags">
        <text class="job-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
      </view>
      <view class="job-footer">
        <text class="job-applied">å·²æŠ¥å {{item.applied}}/{{item.need}}äºº</text>
        <view class="job-actions">
          <text class="job-action">åˆ†äº«</text>
          <text class="job-action">æŠ•è¯‰</text>
        </view>
      </view>
    </view>
    <empty-state wx:if="{{jobList.length === 0}}" text="æš‚æ— æ‹›å·¥ä¿¡æ¯" subText="é™„è¿‘æš‚æ—¶æ²¡æœ‰æ‹›å·¥éœ€æ±‚" />
  </view>
</view>
